# ------------------------------------------------------------------------------
# Copyright (C) 2016-2017 DELL EMC Corporation. All Rights Reserved.

# This software contains the intellectual property of DELL EMC Corporation
# or is licensed to DELL EMC Corporation from third parties.  Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of DELL  EMC.

# ------------------------------------------------------------------------------

# VMs are already expected to be in a powered off state.
# Except for re-sized linux VMs. They ar powered up after resize. Raised JIRA EHCINSTALL-1175.
# This step could be removed after the improvement is fixed.
-
    include: plays/power-off-vms.yml
    vars:
        step: BKP - BPB-150-020
        # TODO: VROPSD01..VROPSD(N) and VROPSR01..vROPSR(N) added...
        vms: all_deployed_vms:!nsx_load_balancers:!additional_pscs

-
    include:  plays/backup-snapshot.yml
    vars:
        step: BKP - BPB-150-030
        description: 'Deployed Automation Pod VMs'
        snapshot_name: BPB-150-Deploy-Automation-Pod
        snapshot_description: 'Deployed Automation Pod VMs'
        # TODO: PSCs missing - need to add all_deployed_vms to list...
        vms: all_deployed_vms:!nsx_load_balancers:vcenter_servers:!additional_pscs
        dumpMemory: True
        powerOffVM: False

-
    include:  plays/backup-postgres-db.yml
    vars:
        step: BKP - BPB-150-190
        fileNamePrefix: BPB-150-190
        vms: vcenter_server
