<style>
  md-list-item.md-3-line, md-list-item.md-3-line > .md-no-style {
    min-height: 0px;
  }
</style>

<div layout="row">
  <div>
    <h3><ng-md-icon icon="photo_library" size="40"></ng-md-icon> Snapshot Manager</h3>
  </div>
  <div flex>
  </div>
  <div ng-if="hasDeployRole && tiles.length">
    <md-button ng-disabled="!selectedComponents.length" md-theme-watch class="md-raised md-hue-2" ng-click="confirmAllSnap($event)" tooltip-placement="auto" uib-tooltip="Create a snapshot of all Virtual Machines at once">
      Snap All
      <ng-md-icon icon="burst_mode"></ng-md-icon>
    </md-button>

    <md-button ng-disabled="!selectedComponents.length" md-theme-watch class="md-raised md-hue-2" ng-click="promptSnapshotNameToRevertAll($event)" tooltip-placement="auto" uib-tooltip="Revert to a snapshot of all Virtual Machines at once">
      Revert All
      <ng-md-icon icon="settings_backup_restore"></ng-md-icon>
    </md-button>
  </div>
</div>
<div layout="row" class="md-whiteframe-1dp" style="padding:20px;margin:10px;" ng-if="!hasDeployRole">
  <h4>You do not have sufficient privileges to view this page.</h4>
  <md-button md-theme="green" class="md-raised md-primary md-hue-2" ng-click="showEmailUs($event)" href=""> <ng-md-icon icon="email" size="24"></ng-md-icon> Request Access </md-button>
</div>
<div class="row" style="margin-right: 0px;" ng-if="hasDeployRole">
  <div ng-if="!tiles.length" layout-margin class="alert alert-info">
    No sufficient data. Head over to <a href="/design">Design</a> section and fill in environment details
  </div>

  <div ng-show="view == 'table'">
    <md-table-container>
      <table md-table md-row-select multiple ng-model="selectedComponents" md-progress="promise">
        <thead md-head md-order="query.order">
        <tr md-row>
          <th md-column md-numeric><span>ID</span></th>
          <th md-column ><span>Name</span></th>
          <th md-column >IP</th>
          <th md-column >Snapshots</th>
          <th md-column >Last Change Time</th>
          <th md-column >Last Status</th>
          <th md-column >Actions</th>
        </tr>
        </thead>
        <tbody md-body>
        <tr md-row md-select="tile" md-select-id="id" ng-disabled="!vmids[tile.objectType]" ng-repeat-start="tile in tiles">

          <td md-cell>{{$index + 1}}</td>
          <td md-cell><product-logo size="'small'" product="tile.objectType"></product-logo> {{tile.title | humanizeText}}</td>
          <td md-cell><span ng-if="tile.ip!=0">{{tile.ip}}</span></td>
          <td md-cell>{{tile.snapshotItems.length}}
            <toggle-button btn-disabled="!tile.snapshotItems.length" show-icon="'keyboard_arrow_right'" hide-icon="'keyboard_arrow_down'" show-state="true" hide-state="false" state="tile.showSnaps"></toggle-button>
          </td>
          <td md-cell>{{tile.logtime | date : "medium"}}</td>
          <td md-cell>
            <status-label progress="tile.progress" status-text="tile.statusText" state="tile.state" progress-text="tile.messageTexts.inProgress" completed-text="tile.messageTexts.done"></status-label>
          </td>
          <td md-cell>
            <md-button ng-disabled="!vmids[tile.objectType] || tile.state=='RUNNING'" class="md-raised md-primary md-hue-2 md-mini" ng-click="promptSnapshotName($event,tile,false)" tooltip-placement="auto" uib-tooltip="Click to create a snapshot">
              Snap
              <ng-md-icon icon="{{tile.buttonIcon}}" ng-if="tile.buttonIcon"></ng-md-icon>
            </md-button>
            <!--<play-button default-text="Snap" progress-text="Creating" completed-text="Created" md-raised="''" action="" state="''"></play-button>-->
            <log-viewer ng-show="vmids[tile.objectType]" job-objects="tile.jobObjects" get-logs-service="getLogsService" tile="tile"></log-viewer>
          </td>
        </tr>
        <tr ng-repeat-end>
          <!--<td md-cell></td>-->
          <td md-cell colspan="8">
            <div uib-collapse="!tile.showSnaps.value">
              <md-list>
                <md-list-item style="min-height: 0px;" class="md-3-line" ng-repeat="trackItem in tile.snapshotItems" ng-click="null">
                  <ng-md-icon icon="{{trackItem.icon}}" ng-class="{'fa-spin':trackItem.icon == 'refresh'}" style="fill:{{trackItem.color}}"></ng-md-icon>
                  <p>{{ trackItem.message}} - {{ trackItem.createTime | date: "medium"}}
                    <md-button style="display:inline-block;" md-theme="red" class="md-mini md-primary md-hue-2" ng-click="showConfirm($event, tile, 'revert', trackItem.snapshotId)"> <ng-md-icon icon="settings_backup_restore" style="fill:#c62828"></ng-md-icon> Revert </md-button>
                    <md-button style="display:inline-block;" md-theme="red" class="md-mini md-primary md-hue-2" ng-click="showConfirm($event, tile, 'delete', trackItem.snapshotId)"> <ng-md-icon icon="delete_forever" style="fill:#c62828"></ng-md-icon> Delete </md-button>
                  </p>
                </md-list-item>
                <md-divider ></md-divider>
              </md-list>
            </div>
          </td>

        </tr>
        </tbody>
      </table>
    </md-table-container>
  </div>

</div>

<div role="info" layout-margin>
  <div class="hint"> Note: Always displays the status of last run activity and does not guarantee the current state of the component. To know the current state check monitor section</div>
</div>
