# ------------------------------------------------------------------------------
# Copyright (C) 2016-2017 DELL EMC Corporation. All Rights Reserved.

# This software contains the intellectual property of DELL EMC Corporation
# or is licensed to DELL EMC Corporation from third parties.  Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of DELL  EMC.

# ------------------------------------------------------------------------------


-
    name: 'RBP - Set rollback point - {{ rollback_point | upper }}'
    hosts: localhost
    tags:
      -   'RBP - Set rollback point - {{ rollback_point | upper }}'
    tasks:
      -   name: 'RBP - Set rollback point - {{ rollback_point | upper }}'
          run_once: True
          delegate_to: localhost
          update_vars:
              base_data_path: rollback_points
              create_file: 'True'
              data:
                  rollback_point: '{{ rollback_point }}'
                  description: '{{ description|default(None) }}'
                  time: "{{ lookup('pipe','date \"+%Y-%m-%d %H:%M:%S %z\"') }}"
                  rollback_playbook_file: '{{ rollback_playbook_file|default(None) or rollback_point }}'
                  vms: '{{ vms|default(None) }}'
              update_type: addUnique
              unique_data:
                  rollback_point: '{{ rollback_point }}'
              vars_file: ../rollback-points.yml
          # when: ENABLE_SAVE_GOOD_CONFIGURATIONS|default(None)